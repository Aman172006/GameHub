<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Event - GameHub</title>
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="../../assets/css/main.css">
    <link rel="stylesheet" href="../../assets/css/dashboard.css">
    <link rel="stylesheet" href="../../assets/css/forms.css">
    
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Favicon -->
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
</head>
<body class="dashboard-body">
    <!-- Dashboard Layout -->
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside class="dashboard-sidebar">
            <div class="sidebar-header">
                <div class="brand-logo">
                    <i class="fas fa-crown"></i>
                    <span>ORGANIZER</span>
                </div>
                <button class="sidebar-toggle" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
            
            <div class="sidebar-user">
                <div class="user-avatar">
                    <i class="fas fa-crown"></i>
                </div>
                <div class="user-info" id="sidebar-user-info">
                    <div class="user-name">Loading...</div>
                    <div class="user-role">Organizer</div>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="dashboard.html" class="nav-link">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="nav-item active">
                        <a href="create-event.html" class="nav-link">
                            <i class="fas fa-plus-circle"></i>
                            <span>Create Event</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="manage-events.html" class="nav-link">
                            <i class="fas fa-cogs"></i>
                            <span>Manage Events</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="registrations.html" class="nav-link">
                            <i class="fas fa-users"></i>
                            <span>Registrations</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="event-analytics.html" class="nav-link">
                            <i class="fas fa-chart-line"></i>
                            <span>Analytics</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="../shared/profile.html" class="nav-link">
                            <i class="fas fa-user"></i>
                            <span>Profile</span>
                        </a>
                    </li>
                </ul>
                
                <div class="sidebar-footer">
                    <button class="btn-logout" onclick="auth.logout()">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </button>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-main">
            <!-- Header -->
            <header class="dashboard-header">
                <div class="header-left">
                    <h1 class="page-title">
                        <i class="fas fa-plus-circle"></i>
                        <span id="page-title-text">Create Event</span>
                    </h1>
                    <p class="page-subtitle">Set up an epic tournament for your gaming community</p>
                </div>
                
                <div class="header-right">
                    <div class="header-actions">
                        <button class="btn-secondary" onclick="goToDashboard()">
                            <i class="fas fa-arrow-left"></i>
                            Back to Dashboard
                        </button>
                        <button class="btn-primary" id="save-draft-btn" onclick="saveDraft()">
                            <i class="fas fa-save"></i>
                            Save Draft
                        </button>
                    </div>
                </div>
            </header>

            <!-- Form Content -->
            <div class="dashboard-content">
                <div class="form-container">
                    <form id="event-form" class="event-form">
                        <!-- Basic Information -->
                        <div class="form-section">
                            <div class="section-header">
                                <h3 class="section-title">
                                    <i class="fas fa-info-circle"></i>
                                    Basic Information
                                </h3>
                                <p class="section-subtitle">Essential details about your event</p>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group full-width">
                                    <label for="event-title" class="form-label">
                                        <i class="fas fa-trophy"></i>
                                        Event Title *
                                    </label>
                                    <input 
                                        type="text" 
                                        id="event-title" 
                                        name="title" 
                                        class="form-input" 
                                        placeholder="Enter an exciting event title..."
                                        required
                                        maxlength="100"
                                    >
                                    <div class="form-hint">Make it catchy and memorable!</div>
                                </div>
                                
                                <div class="form-group full-width">
                                    <label for="event-description" class="form-label">
                                        <i class="fas fa-align-left"></i>
                                        Description *
                                    </label>
                                    <textarea 
                                        id="event-description" 
                                        name="description" 
                                        class="form-textarea" 
                                        placeholder="Describe your event in detail..."
                                        required
                                        rows="4"
                                        maxlength="1000"
                                    ></textarea>
                                    <div class="form-hint">Tell players what makes this event special</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="event-category" class="form-label">
                                        <i class="fas fa-tags"></i>
                                        Category *
                                    </label>
                                    <select id="event-category" name="category" class="form-select" required>
                                        <option value="">Select a category</option>
                                        <option value="FPS">FPS (First Person Shooter)</option>
                                        <option value="MOBA">MOBA (Multiplayer Online Battle Arena)</option>
                                        <option value="Battle Royale">Battle Royale</option>
                                        <option value="Sports">Sports Games</option>
                                        <option value="Racing">Racing Games</option>
                                        <option value="Strategy">Strategy Games</option>
                                        <option value="Fighting">Fighting Games</option>
                                        <option value="RPG">Role-Playing Games</option>
                                        <option value="Casual">Casual Games</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="max-participants" class="form-label">
                                        <i class="fas fa-users"></i>
                                        Max Participants *
                                    </label>
                                    <input 
                                        type="number" 
                                        id="max-participants" 
                                        name="max_participants" 
                                        class="form-input" 
                                        placeholder="e.g., 64"
                                        required
                                        min="2"
                                        max="1000"
                                    >
                                    <div class="form-hint">How many players can join?</div>
                                </div>
                            </div>
                        </div>

                        <!-- Date & Time -->
                        <div class="form-section">
                            <div class="section-header">
                                <h3 class="section-title">
                                    <i class="fas fa-calendar-alt"></i>
                                    Schedule
                                </h3>
                                <p class="section-subtitle">When will your event take place?</p>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="event-date" class="form-label">
                                        <i class="fas fa-calendar"></i>
                                        Event Date *
                                    </label>
                                    <input 
                                        type="date" 
                                        id="event-date" 
                                        name="date" 
                                        class="form-input" 
                                        required
                                    >
                                </div>
                                
                                <div class="form-group">
                                    <label for="event-time" class="form-label">
                                        <i class="fas fa-clock"></i>
                                        Start Time *
                                    </label>
                                    <input 
                                        type="time" 
                                        id="event-time" 
                                        name="time" 
                                        class="form-input" 
                                        required
                                    >
                                </div>
                                
                                <div class="form-group full-width">
                                    <label for="event-location" class="form-label">
                                        <i class="fas fa-map-marker-alt"></i>
                                        Location *
                                    </label>
                                    <input 
                                        type="text" 
                                        id="event-location" 
                                        name="location" 
                                        class="form-input" 
                                        placeholder="Online, Gaming Center, Discord Server..."
                                        required
                                        maxlength="200"
                                    >
                                    <div class="form-hint">Where will players compete?</div>
                                </div>
                            </div>
                        </div>

                        <!-- Advanced Settings -->
                        <div class="form-section">
                            <div class="section-header">
                                <h3 class="section-title">
                                    <i class="fas fa-cog"></i>
                                    Advanced Settings
                                </h3>
                                <p class="section-subtitle">Optional configuration for your event</p>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="registration-deadline" class="form-label">
                                        <i class="fas fa-hourglass-end"></i>
                                        Registration Deadline
                                    </label>
                                    <input 
                                        type="datetime-local" 
                                        id="registration-deadline" 
                                        name="registration_deadline" 
                                        class="form-input"
                                    >
                                    <div class="form-hint">When should registration close?</div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="entry-fee" class="form-label">
                                        <i class="fas fa-dollar-sign"></i>
                                        Entry Fee
                                    </label>
                                    <input 
                                        type="number" 
                                        id="entry-fee" 
                                        name="entry_fee" 
                                        class="form-input" 
                                        placeholder="0"
                                        min="0"
                                        step="0.01"
                                    >
                                    <div class="form-hint">Leave blank or 0 for free events</div>
                                </div>
                                
                                <div class="form-group full-width">
                                    <label for="prize-pool" class="form-label">
                                        <i class="fas fa-trophy"></i>
                                        Prize Pool
                                    </label>
                                    <textarea 
                                        id="prize-pool" 
                                        name="prize_pool" 
                                        class="form-textarea" 
                                        placeholder="1st Place: $500, 2nd Place: $300, 3rd Place: $200..."
                                        rows="3"
                                        maxlength="500"
                                    ></textarea>
                                    <div class="form-hint">Describe the prizes for winners</div>
                                </div>
                                
                                <div class="form-group full-width">
                                    <label for="rules" class="form-label">
                                        <i class="fas fa-list-ul"></i>
                                        Rules & Guidelines
                                    </label>
                                    <textarea 
                                        id="rules" 
                                        name="rules" 
                                        class="form-textarea" 
                                        placeholder="Enter competition rules, requirements, and guidelines..."
                                        rows="4"
                                        maxlength="2000"
                                    ></textarea>
                                    <div class="form-hint">Clear rules ensure fair competition</div>
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information -->
                        <div class="form-section">
                            <div class="section-header">
                                <h3 class="section-title">
                                    <i class="fas fa-phone"></i>
                                    Contact Information
                                </h3>
                                <p class="section-subtitle">How can participants reach you?</p>
                            </div>
                            
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="contact-email" class="form-label">
                                        <i class="fas fa-envelope"></i>
                                        Contact Email
                                    </label>
                                    <input 
                                        type="email" 
                                        id="contact-email" 
                                        name="contact_email" 
                                        class="form-input" 
                                        placeholder="your-email@example.com"
                                    >
                                </div>
                                
                                <div class="form-group">
                                    <label for="discord-server" class="form-label">
                                        <i class="fab fa-discord"></i>
                                        Discord Server
                                    </label>
                                    <input 
                                        type="url" 
                                        id="discord-server" 
                                        name="discord_server" 
                                        class="form-input" 
                                        placeholder="https://discord.gg/..."
                                    >
                                </div>
                                
                                <div class="form-group full-width">
                                    <label for="additional-info" class="form-label">
                                        <i class="fas fa-info-circle"></i>
                                        Additional Information
                                    </label>
                                    <textarea 
                                        id="additional-info" 
                                        name="additional_info" 
                                        class="form-textarea" 
                                        placeholder="Any other important details participants should know..."
                                        rows="3"
                                        maxlength="1000"
                                    ></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="resetForm()">
                                <i class="fas fa-undo"></i>
                                Reset Form
                            </button>
                            <button type="button" class="btn-outline" onclick="previewEvent()">
                                <i class="fas fa-eye"></i>
                                Preview Event
                            </button>
                            <button type="submit" class="btn-primary btn-large">
                                <i class="fas fa-rocket"></i>
                                <span id="submit-btn-text">Create Event</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <!-- Preview Modal -->
    <div id="preview-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3><i class="fas fa-eye"></i> Event Preview</h3>
                <span class="modal-close" onclick="closeModal('preview-modal')">&times;</span>
            </div>
            <div id="preview-content" class="modal-body">
                <!-- Preview content will be generated here -->
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="closeModal('preview-modal')">Close</button>
                <button class="btn-primary" onclick="submitFormFromPreview()">
                    <i class="fas fa-rocket"></i>
                    Create Event
                </button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../../config/api-config.js"></script>
    <script src="../../assets/js/api.js"></script>
    <script src="../../assets/js/auth.js"></script>
    <script src="../../assets/js/utils.js"></script>
    
    <script>
        let isEditMode = false;
        let editEventId = null;

        // Initialize create event page
        document.addEventListener('DOMContentLoaded', async function() {
            // Check authentication and role
            if (!auth.requireOrganizer()) {
                return;
            }
            
            // Update user info in sidebar
            const user = auth.getCurrentUser();
            if (user) {
                updateSidebarUserInfo(user);
            }
            
            // Check if we're editing an existing event
            editEventId = localStorage.getItem('editEventId');
            if (editEventId) {
                isEditMode = true;
                localStorage.removeItem('editEventId');
                await loadEventForEditing(editEventId);
            }
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('event-date').min = today;
            
            // Setup form validation
            setupFormValidation();
            
            // Auto-save functionality
            setupAutoSave();
        });

        // Update sidebar user info
        function updateSidebarUserInfo(user) {
            const userInfo = document.getElementById('sidebar-user-info');
            if (userInfo) {
                userInfo.innerHTML = `
                    <div class="user-name">${user.name}</div>
                    <div class="user-role">${user.role}</div>
                `;
            }
        }

        // Load event for editing
        async function loadEventForEditing(eventId) {
            try {
                showLoadingState('Loading event details...');
                
                const event = await window.api.getEventDetails(eventId);
                
                // Update page title
                document.getElementById('page-title-text').textContent = 'Edit Event';
                document.getElementById('submit-btn-text').textContent = 'Update Event';
                
                // Populate form fields
                document.getElementById('event-title').value = event.title || '';
                document.getElementById('event-description').value = event.description || '';
                document.getElementById('event-category').value = event.category || '';
                document.getElementById('max-participants').value = event.max_participants || '';
                document.getElementById('event-date').value = event.date || '';
                document.getElementById('event-time').value = event.time || '';
                document.getElementById('event-location').value = event.location || '';
                
                // Optional fields
                if (event.registration_deadline) {
                    document.getElementById('registration-deadline').value = event.registration_deadline;
                }
                if (event.entry_fee !== undefined) {
                    document.getElementById('entry-fee').value = event.entry_fee;
                }
                if (event.prize_pool) {
                    document.getElementById('prize-pool').value = event.prize_pool;
                }
                if (event.rules) {
                    document.getElementById('rules').value = event.rules;
                }
                if (event.contact_email) {
                    document.getElementById('contact-email').value = event.contact_email;
                }
                if (event.discord_server) {
                    document.getElementById('discord-server').value = event.discord_server;
                }
                if (event.additional_info) {
                    document.getElementById('additional-info').value = event.additional_info;
                }
                
            } catch (error) {
                console.error('Error loading event for editing:', error);
                showNotification('Failed to load event details', 'error');
                goToDashboard();
            } finally {
                hideLoadingState();
            }
        }

        // Setup form validation
        function setupFormValidation() {
            const form = document.getElementById('event-form');
            const inputs = form.querySelectorAll('input, textarea, select');
            
            inputs.forEach(input => {
                input.addEventListener('blur', validateField);
                input.addEventListener('input', clearFieldError);
            });
            
            form.addEventListener('submit', handleFormSubmit);
        }

        // Validate individual field
        function validateField(event) {
            const field = event.target;
            const value = field.value.trim();
            
            // Remove existing error
            clearFieldError({ target: field });
            
            // Required field validation
            if (field.hasAttribute('required') && !value) {
                showFieldError(field, 'This field is required');
                return false;
            }
            
            // Email validation
            if (field.type === 'email' && value && !isValidEmail(value)) {
                showFieldError(field, 'Please enter a valid email address');
                return false;
            }
            
            // URL validation
            if (field.type === 'url' && value && !isValidURL(value)) {
                showFieldError(field, 'Please enter a valid URL');
                return false;
            }
            
            // Date validation (not in the past)
            if (field.type === 'date' && value) {
                const selectedDate = new Date(value);
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                if (selectedDate < today) {
                    showFieldError(field, 'Event date cannot be in the past');
                    return false;
                }
            }
            
            // Number validation
            if (field.type === 'number' && value) {
                const num = parseFloat(value);
                const min = parseFloat(field.min);
                const max = parseFloat(field.max);
                
                if (min !== undefined && num < min) {
                    showFieldError(field, `Minimum value is ${min}`);
                    return false;
                }
                
                if (max !== undefined && num > max) {
                    showFieldError(field, `Maximum value is ${max}`);
                    return false;
                }
            }
            
            return true;
        }

        // Show field error
        function showFieldError(field, message) {
            field.classList.add('error');
            
            let errorElement = field.parentNode.querySelector('.field-error');
            if (!errorElement) {
                errorElement = document.createElement('div');
                errorElement.className = 'field-error';
                field.parentNode.appendChild(errorElement);
            }
            
            errorElement.textContent = message;
        }

        // Clear field error
        function clearFieldError(event) {
            const field = event.target;
            field.classList.remove('error');
            
            const errorElement = field.parentNode.querySelector('.field-error');
            if (errorElement) {
                errorElement.remove();
            }
        }

        // Handle form submission
        async function handleFormSubmit(event) {
            event.preventDefault();
            
            if (!validateForm()) {
                showNotification('Please fix the errors in the form', 'error');
                return;
            }
            
            await submitEvent();
        }

        // Validate entire form
        function validateForm() {
            const form = document.getElementById('event-form');
            const inputs = form.querySelectorAll('input[required], textarea[required], select[required]');
            let isValid = true;
            
            inputs.forEach(input => {
                if (!validateField({ target: input })) {
                    isValid = false;
                }
            });
            
            return isValid;
        }

        // Submit event
        async function submitEvent() {
            try {
                // Check if API is available
                if (!window.api) {
                    throw new Error('API not loaded. Please refresh the page and try again.');
                }

                const submitBtn = document.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;

                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';
                submitBtn.disabled = true;

                const formData = getFormData();

                let result;
                if (isEditMode && editEventId) {
                    result = await window.api.updateEvent(editEventId, formData);
                    showNotification('Event updated successfully!', 'success');
                } else {
                    result = await window.api.createEvent(formData);
                    showNotification('Event created successfully!', 'success');
                }

                // Clear auto-save data
                clearAutoSaveData();

                // Redirect to dashboard after a short delay
                setTimeout(() => {
                    goToDashboard();
                }, 2000);

            } catch (error) {
                console.error('Error submitting event:', error);
                showNotification(error.message || 'Failed to save event. Please try again.', 'error');

                const submitBtn = document.querySelector('button[type="submit"]');
                submitBtn.innerHTML = isEditMode ?
                    '<i class="fas fa-rocket"></i> Update Event' :
                    '<i class="fas fa-rocket"></i> Create Event';
                submitBtn.disabled = false;
            }
        }

        // Get form data
        function getFormData() {
            const form = document.getElementById('event-form');
            const formData = new FormData(form);
            const data = {};
            
            // Convert FormData to object
            for (let [key, value] of formData.entries()) {
                if (value.trim()) {
                    data[key] = value.trim();
                }
            }
            
            // Convert max_participants to number
            if (data.max_participants) {
                data.max_participants = parseInt(data.max_participants);
            }
            
            // Convert entry_fee to number if present
            if (data.entry_fee) {
                data.entry_fee = parseFloat(data.entry_fee);
            }
            
            return data;
        }

        // Preview event
        function previewEvent() {
            if (!validateForm()) {
                showNotification('Please fill in all required fields first', 'warning');
                return;
            }
            
            const data = getFormData();
            generatePreview(data);
            openModal('preview-modal');
        }

        // Generate preview content
        function generatePreview(data) {
            const previewContent = document.getElementById('preview-content');
            
            previewContent.innerHTML = `
                <div class="event-preview">
                    <div class="preview-header">
                        <h2 class="preview-title">${data.title}</h2>
                        <span class="preview-category">${data.category}</span>
                    </div>
                    
                    <div class="preview-meta">
                        <div class="meta-item">
                            <i class="fas fa-calendar"></i>
                            <span>${formatPreviewDate(data.date, data.time)}</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>${data.location}</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-users"></i>
                            <span>${data.max_participants} participants max</span>
                        </div>
                        ${data.entry_fee ? `
                            <div class="meta-item">
                                <i class="fas fa-dollar-sign"></i>
                                <span>$${data.entry_fee} entry fee</span>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="preview-description">
                        <h4>Description</h4>
                        <p>${data.description}</p>
                    </div>
                    
                    ${data.prize_pool ? `
                        <div class="preview-section">
                            <h4>Prize Pool</h4>
                            <p>${data.prize_pool}</p>
                        </div>
                    ` : ''}
                    
                    ${data.rules ? `
                        <div class="preview-section">
                            <h4>Rules & Guidelines</h4>
                            <p>${data.rules}</p>
                        </div>
                    ` : ''}
                    
                    ${data.additional_info ? `
                        <div class="preview-section">
                            <h4>Additional Information</h4>
                            <p>${data.additional_info}</p>
                        </div>
                    ` : ''}
                    
                    <div class="preview-contact">
                        <h4>Contact Information</h4>
                        ${data.contact_email ? `<p><i class="fas fa-envelope"></i> ${data.contact_email}</p>` : ''}
                        ${data.discord_server ? `<p><i class="fab fa-discord"></i> <a href="${data.discord_server}" target="_blank">Discord Server</a></p>` : ''}
                    </div>
                </div>
            `;
        }

        // Submit form from preview
        function submitFormFromPreview() {
            closeModal('preview-modal');
            document.getElementById('event-form').dispatchEvent(new Event('submit'));
        }

        // Reset form
        function resetForm() {
            if (confirm('Are you sure you want to reset the form? All data will be lost.')) {
                document.getElementById('event-form').reset();
                clearAllFieldErrors();
                clearAutoSaveData();
                showNotification('Form has been reset', 'info');
            }
        }

        // Clear all field errors
        function clearAllFieldErrors() {
            const form = document.getElementById('event-form');
            const errorFields = form.querySelectorAll('.error');
            const errorMessages = form.querySelectorAll('.field-error');
            
            errorFields.forEach(field => field.classList.remove('error'));
            errorMessages.forEach(error => error.remove());
        }

        // Auto-save functionality
        function setupAutoSave() {
            const form = document.getElementById('event-form');
            const inputs = form.querySelectorAll('input, textarea, select');
            
            inputs.forEach(input => {
                input.addEventListener('input', debounce(autoSave, 2000));
            });
            
            // Load auto-saved data
            loadAutoSaveData();
        }

        // Auto-save form data
        function autoSave() {
            if (isEditMode) return; // Don't auto-save in edit mode
            
            const data = getFormData();
            localStorage.setItem('event-form-autosave', JSON.stringify({
                data: data,
                timestamp: Date.now()
            }));
        }

        // Load auto-saved data
        function loadAutoSaveData() {
            if (isEditMode) return; // Don't load auto-save in edit mode
            
            const autoSaveData = localStorage.getItem('event-form-autosave');
            if (!autoSaveData) return;
            
            try {
                const { data, timestamp } = JSON.parse(autoSaveData);
                
                // Check if auto-save is less than 24 hours old
                const hoursSinceAutoSave = (Date.now() - timestamp) / (1000 * 60 * 60);
                if (hoursSinceAutoSave > 24) {
                    clearAutoSaveData();
                    return;
                }
                
                // Ask user if they want to restore
                if (confirm('We found auto-saved form data. Would you like to restore it?')) {
                    populateFormWithData(data);
                    showNotification('Auto-saved data restored', 'success');
                }
            } catch (error) {
                console.error('Error loading auto-save data:', error);
                clearAutoSaveData();
            }
        }

        // Populate form with data
        function populateFormWithData(data) {
            Object.keys(data).forEach(key => {
                const field = document.querySelector(`[name="${key}"]`);
                if (field) {
                    field.value = data[key];
                }
            });
        }

        // Clear auto-save data
        function clearAutoSaveData() {
            localStorage.removeItem('event-form-autosave');
        }

        // Save draft
        function saveDraft() {
            const data = getFormData();
            
            // Save to localStorage as draft
            const drafts = JSON.parse(localStorage.getItem('event-drafts') || '[]');
            const draftId = Date.now();
            
            drafts.push({
                id: draftId,
                title: data.title || 'Untitled Event',
                data: data,
                created: new Date().toISOString()
            });
            
            localStorage.setItem('event-drafts', JSON.stringify(drafts));
            showNotification('Draft saved successfully!', 'success');
        }

        // Navigation functions
        function goToDashboard() {
            window.location.href = 'dashboard.html';
        }

        function toggleSidebar() {
            const sidebar = document.querySelector('.dashboard-sidebar');
            sidebar.classList.toggle('show');
        }

        // Utility functions
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function isValidURL(url) {
            try {
                new URL(url);
                return true;
            } catch {
                return false;
            }
        }

        function formatPreviewDate(date, time) {
            const dateObj = new Date(`${date}T${time}`);
            return dateObj.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Modal functions
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('show');
                modal.style.display = 'flex';
                document.body.style.overflow = 'hidden';
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('show');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 300);
                document.body.style.overflow = 'auto';
            }
        }

        // Loading state functions
        function showLoadingState(message = 'Loading...') {
            const loadingOverlay = document.createElement('div');
            loadingOverlay.id = 'loading-overlay';
            loadingOverlay.innerHTML = `
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <p>${message}</p>
                </div>
            `;
            document.body.appendChild(loadingOverlay);
        }

        function hideLoadingState() {
            const loadingOverlay = document.getElementById('loading-overlay');
            if (loadingOverlay) {
                loadingOverlay.remove();
            }
        }

        // Notification function
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            
            const icon = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            }[type];
            
            notification.innerHTML = `
                <div class="notification-content">
                    <i class="${icon}"></i>
                    <span>${message}</span>
                </div>
                <button class="notification-close" onclick="closeNotification(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                closeNotification(notification.querySelector('.notification-close'));
            }, 5000);
        }

        function closeNotification(button) {
            const notification = button.closest('.notification');
            notification.classList.remove('show');
            setTimeout(() => {
                notification.remove();
            }, 300);
        }
    </script>
</body>
</html>
